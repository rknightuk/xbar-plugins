#!/bin/bash

# <xbar.title>Microphone Status</xbar.title>
# <xbar.version>v1.0</xbar.version>
# <xbar.author>Robb Knight</xbar.author>
# <xbar.author.github>rknightuk</xbar.author.github>
# <xbar.desc>Shows microphone status</xbar.desc>
# <xbar.image></xbar.image>
# <xbar.dependencies>BASH</xbar.dependencies>

# Modified from https://github.com/matryer/xbar-plugins/blob/master/System/microphone.sh

ICON_MIC="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAAAAABWESUoAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVQ4jY2Sv04UURTGf/fOTqZwC0BjNhSSlURMNiEhhlhQaMIDYGcCHbwAT0ChHW8guhotTKzstKazJDREN/ivUJYAWVeEzM7c+1nM7M66g9FTTeb8zjnf+e6BQViqG604bm1UsVwQlvqunOS0W7+IMIzvKXGSS7Q3jikBAZuKJUmKtUlQbhB9lMsAp/2o1MIy3ZPPAK/e9EBFoSYK+1WGMBqq/EcUQFn3/3WoABAYjSZMRa4AXLlTls5GGNafVEfqqTbXi61qHa0wq6GYZUWdGgYsGEJDxEhEmDAH/rbLUMp5KqSOfBXhEip4lwOi22WSb+2i+OA7k/zoogwwp5+Yp/OGNEunvO0wz+fTvjsVHurnDNcP1fOS76ld5+apHuQmgaVxrqewcCwveR0vwDOdNwrtAVvSGkw12963m1OwJj0auirDlZaSVSxjjcYYltVErcvD72uZO5Fe1DFgqD+XTubyATkVuLnXU/zafndA7fbdS3y5txO4P2wLmNiKs6P0ih9PDASYYoq/sXxn5iqH77dffrD4kvVhhGVRWsQShYPflcFXAoYzOMMQUwbM/WuJjWdg+Vbkw6+vRm4wYElpcS+plvoqczfF/pFJ0tSBS9PEHO333/43jAztfMWb5IQAAAAASUVORK5CYII="
ICON_MIC_SLASH="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAAAAABWESUoAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJElEQVQ4jW2Sz0tUURTHv+e8OzOUYVmLpEUxGCU2EhFBIirhsoVSbspwUctauC6KaBn9AxESBREyLdq1FFxbWEQRQmWQJpKNOda8H/d+W7z3Zu5IZ3k/33vu/Z7zBZql2HNnKQw/3eqA4j+lKL+jJS0Xy6lC2rig6yNjS9qYHzohEJU2RYD7DEmSbPABApHiLr+HoPSZliTpLKdgRF6+2espFD0RXcYnYVSr5EJXS6HoI5u8KFplw/3tbfnJBSlXrbLBrSHPbyZo48MIsEOwg5uWRxOgj7Qer59DoX2OfXRJzkNuDXvvC6ZnOlGhbfH6YPBkOvco6K5xEv0u55HlRUyx1g0BFBAUBCWIXHlWTDA7ERcUSzCQQiYAoCB0KudIj1NkAMI6KN4vmoxTbAgDZ5HLNn/hKGBcfh8/VnEIm79BQAHq9lcsAE2e4FUNZ/ClLsyjcPNGur/Qki7iWhm9dd7zJmkkkIzT8ecg8Jh/TvijMqpVRtxYplubOQJcIx+2rSqdX22o2F/ZB8XVmEsH/DiJVhmGvI4AEJSfkhunsgcEgFJmJyKj2Ho9/x0Hz450YHl8MbDND4hW2eDqzHYWSoaP9nsfEKT5GEHP7bmVJFmZu3sM6u+68CLNz25RjJKjUJS8rChOMsryEWCAHPDtAcbp20vP6+fnixcOxxoeBy6fLrnCt1n6PcZHgDEmbFbCMb9PADGorNsojhMyiePIrlfyOf8DeVZaaM73AA8AAAAASUVORK5CYII="

NEW_ICON_MIC="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"
NEW_ICON_MIC_SLASH="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"

CUR_INPUT_VOLUME=$(osascript -e "input volume of (get volume settings)")
if [ "${CUR_INPUT_VOLUME}" -eq 0 ]; then
    CUR_ICON="${NEW_ICON_MIC_SLASH}"
else
    CUR_ICON=${NEW_ICON_MIC}
fi

echo "| image=$CUR_ICON" 